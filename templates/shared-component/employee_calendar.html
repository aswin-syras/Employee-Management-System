{% extends "shared-component/index.html" %}
{% block title %} Edit Employee {% endblock title %}
{% block content %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/bootstrap-select.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/css/bootstrap-select.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.5.1/main.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.5.1/main.min.js"></script>
    <script src="https://kit.fontawesome.com/dcd863c3d4.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
    <style>
        a {
            color: black;
        }
    </style>
    <div class="container-fluid calendar-container-fluid m-5">
        <div class="mb-1">
            <a class="btn btn-primary" href="{{url_for('editEmployee', id=employee_id)}}" class="btn btn-primary"> <i class="fas fa-chevron-left"></i>&nbsp;  Back to the Employee </a>
        </div>

        <div id="calendar"></div>

        <!--  # Scroll to the top-->
        <a id="back-to-top" href="#" class="btn btn-light btn-lg back-to-top" role="button" ><i class="fas fa-chevron-up"></i></a>
    </div>

    <script>
        var calendarElement = document.getElementById("calendar");
        console.log("calendarElement:", calendarElement);

        var calendar = new FullCalendar.Calendar(calendarElement, {
            events: [
                {% for event in events %}
					{
						id: '{{ event._id }}',
						title: '{{event.title}}',
						start: '{{event.start}}',
						extendedProps: {
							_id: '{{ event._id }}',
							employee_id: {{ event.employee_id }},
							old_start: '{{event.start}}',
							end: '{{ event.end }}',
							manager_id: '{{ event.manager_id }}',
							title: '{{ event.title }}'
						 },
					},
                {% endfor %}
            ],
			timeZone: 'UTC',
            headerToolbar: {
				left: 'prev,next today',
				center: 'title',
				right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            editable: true,
            dayMaxEvents: true, // when too many events in a day, show the popover

			eventClick: function(info) {
				info.jsEvent.preventDefault(); // don't let the browser navigate
				//window.open("https://www.google.com/");
				console.log("OPEN ME");

				console.log("PARAMS: ", info, info.event.extendedProps);
				var eventData = {
						title: info.event.title ,
						start: info.event.start.toISOString(),

				};
				eventData = {...eventData, ...info.event.extendedProps}


				console.log("*********------: ", eventData._id);

				//$.post('{{url_for("admin.return_data")}}', { 'title': info.event.title ,
				 //   'start': info.event.start.toISOString()} )

				$.ajax({
				type: "GET",
				url: '/getExistingEvent/'+ info.event.extendedProps._id+ '/' + 0 + "/" + 'empId' + '/' + info.event.extendedProps.employee_id,
				success: function(response) {
					// do something
					window.open(window.location.origin+'/getExistingEvent/'+ info.event.extendedProps._id + '/' + 0 + "/" + 'empId' + '/' + info.event.extendedProps.employee_id,"_self");
					},
				error: function (xhr, status, error) {
					console.log(error);
					}
				});
			}
		});
        calendar.render();
    </script>
{% endblock content %}